#!/bin/sh

if [ -t 0 ]; then
    if [ "$XDG_SESSION_TYPE" = "wayland" ] || [ -n "$WAYLAND_DISPLAY" ]; then
        if command -v wl-paste >/dev/null 2>&1; then
            wl-paste
        else
            echo "Error: wl-paste not found. Please install wl-clipboard." >&2
            exit 1
        fi
    else
        if command -v xclip >/dev/null 2>&1; then
            xclip -selection clipboard -o
        else
            echo "Error: xclip not found. Please install xclip." >&2
            exit 1
        fi
    fi

else
    temp_file=$(mktemp)
    trap 'rm -f "$temp_file"' EXIT

    cat > "$temp_file"

    if [ "$XDG_SESSION_TYPE" = "wayland" ] || [ -n "$WAYLAND_DISPLAY" ]; then
        # Wayland
        if command -v wl-copy >/dev/null 2>&1; then
            wl-copy < "$temp_file"
        else
            echo "Error: wl-copy not found. Please install wl-clipboard." >&2
            exit 1
        fi
    else
        if command -v xclip >/dev/null 2>&1; then
            xclip -selection primary < "$temp_file"
            xclip -selection clipboard < "$temp_file"
        else
            echo "Error: xclip not found. Please install xclip." >&2
            exit 1
        fi
    fi
fi
